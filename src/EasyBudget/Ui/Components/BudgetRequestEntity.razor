@using EasyBudget.Presentation.Enums
<h3>BudgetRequestEntity</h3>

@if (true)
{
    <div>
        <div>
            @{
                if (ViewModel.BudgetRequestViewModel.IsEditable)
                {
                    <button @onclick="ViewModel.BudgetRequestViewModel.ChangeMode">Редагувати</button>
                }
                else
                {
                    <button disabled="disabled">Редагувати</button>
                }
                if (ViewModel.BudgetRequestViewModel.ApproveAble)
                {
                    <button @onclick="ViewModel.BudgetRequestViewModel.ApproveRequest">Затвердити</button>
                }
                else
                {
                    <button disabled="disabled">Затвердити</button>
                }

            }
        </div>
        <div>
            @{
                <label>Назва: </label>
                if (ViewModel.BudgetRequestViewModel.NameField == FieldsStates.NotEditable)
                {
                    <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Name</label>
                }
                else
                {
                    <input @bind="ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Name">
                }

            }
        </div>
        <div>
            <div>
                <label>Ініціатор: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Requester.Name</label>
            </div>
            <div>
                <label>Затверджувач: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Approver.Name</label>
            </div>
            <div>
                <label>Виконавець: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Executor.Name</label>
            </div>
            <div>
                <label>Стан: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.State.ToString()</label>
            </div>
        </div>
        <div>
            <div>
                <label>Орієнтовна ціна:</label>
                @if (ViewModel.BudgetRequestViewModel.EstimatedPriceField == FieldsStates.NotEditable)
                {
                    <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.EstimatedPrice</label>
                }
                else
                {
                    <input @bind="ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.EstimatedPrice"/>
                }
            </div>
            <div>
                <label>Точна ціна: </label>
                @if (ViewModel.BudgetRequestViewModel.RealPriceField == FieldsStates.NotEditable)
                {
                    <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.RealPrice</label>
                }
                else
                {
                    <input @bind="ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.RealPrice"/>
                }
            </div>
            <div>
                <label>Відділ:</label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Department.Name</label>
            </div>
            <div>
                <label>Юніт:</label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.Unit.Name</label>
            </div>
        </div>
        <div>
            <div>
                <label>Дата запиту: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateRequested</label>
            </div>
            <div>
                <label>Запрошений дедлайн: </label>
                @if (ViewModel.BudgetRequestViewModel.DateRequestedDeadlineField == FieldsStates.NotEditable)
                {
                    <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateRequestedDeadline</label>
                }
                else
                {
                    <input type="date" @bind="ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateRequestedDeadline"/>
                }
            </div>
            <div>
                <label>Дата затвердження директором: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateDirectorApprove</label>
            </div>
            <div>
                <label>Дата початку виконання: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateStartExecution</label>
            </div>
            <div>
                <label>Встановлений дедлайн: </label>
                @if (ViewModel.BudgetRequestViewModel.DateDeadlineExecutionField == FieldsStates.NotEditable)
                {
                    <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateDeadlineExecution</label>
                }
                else
                {
                    <input type="date" @bind="ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateDeadlineExecution"/>
                }
            </div>
            <div>
                <label>Дата завершення виконання: </label>
                <label>@ViewModel.BudgetRequestViewModel.ChangedBudgetRequest.DateEndExecution</label>
            </div>
        </div>
        <div>
            @{
                if (ViewModel.BudgetRequestViewModel.InEditMode)
                {
                    <button>Скасувати зміни</button>
                }
                else
                {
                    <button disabled="disabled">Скасувати зміни</button>
                }
            }
        </div>
    </div>
}
else
{
    
}



@code {

    [Parameter]
    public IBudgetRequestListViewModel ViewModel { get; set; }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            ViewModel.ViewModelChanged += () => this.InvokeAsync(StateHasChanged);
        }
        
        await base.OnAfterRenderAsync(firstRender);
    }
}
